\documentclass{article}
\input{../../../mod.sty}

\title{\texttt{fn sample\_bernoulli\_exp}}
\author{Michael Shoemate}

\begin{document}
\maketitle

From \href{https://arxiv.org/pdf/2004.00010.pdf#subsection.5.1}{subsection 5.1} of \cite{CKS20}.

\section{Pseudocode}
\subsubsection*{Precondition}
$\texttt{x} \in \mathbb{Q} \land \texttt{x} > 0$

\subsubsection*{Implementation}        
\begin{lstlisting}[language=Python]
def sample_bernoulli_exp(x) -> bool:
    while x >= 1:
        if sample_bernoulli_exp1(1):
            x -= 1
        else: 
            return False
    return sample_bernoulli_exp1(x)
\end{lstlisting}

\subsubsection*{Postcondition}
\texttt{sample\_bernoulli\_exp} returns a boolean sample from $Bernoulli(exp(-x))$, or an error propagated from \texttt{sample\_bernoulli\_exp1}.

\section{Proof}

Let $r$ be the return value of \texttt{sample\_bernoulli\_exp(x)}, assuming the preconditions are met, and the function does not return an error.

\begin{theorem}
$r$ is a realization of $R \sim Bernoulli(exp(-x))$, where $x \in \mathbb{Q}$ and $x > 0$ \cite{CKS20}.
\end{theorem}

\begin{proof}
Let $B_i \sim Bernoulli(exp(-1))$ be the sequence of booleans returned from \texttt{sample\_bernoulli\_exp1(1)}, and $C \sim Bernoulli(exp(-(x - \lfloor x \rfloor)))$.
The function only returns $\top$ if $B_i = \top$ for all $i$ and $C = \top$.

\begin{align*}
    P[R = \top] &= P[B_1 = B_2 = ... = B_{\lfloor x \rfloor} = C = \top] \\
    &= \prod_{i=1}^{\lfloor x \rfloor} P[B_i = \top] P[C = \top] && \text{All $B_i$ are independent.} \\
    &= exp(-1)^{\lfloor x \rfloor} exp(\lfloor x \rfloor - x) \\
    &= exp(-x)
\end{align*}
\end{proof}

\bibliographystyle{alpha}
\bibliography{mod}

\end{document}