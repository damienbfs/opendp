\documentclass{article}
\input{../../lib.sty}


\title{\texttt{fn make\_rappor}}
\author{Abigail Gentle}
\begin{document}

\maketitle



\contrib

Proves soundness of \rustdoc{measurements/fn}{make\_rappor} in \asOfCommit{mod.rs}{304ef9c2}.

TODO: algorithm outline
\section{Hoare Triple}
\subsection{Preconditions}
\begin{itemize}
	\item Variable 
\end{itemize}


\section{Proof}
$f/2$ refers to the probability of 
\begin{theorem}~\cite{rappor}
	\rustdoc{measurements/fn}{make\_rappor} satisfies $\varepsilon$-DP where 
	\begin{equation}
		\varepsilon = 2m\log\left(\frac{2-f}{f}\right)
	\end{equation}
\end{theorem}
\begin{lemma}
	\begin{align}
		P[y_i = 1~|~x_i=1] &= 1 - \frac{1}{2}f\\
		P[y_i = 1~|~x_i=0] &=\frac{1}{2}f
	\end{align}
\end{lemma}
\begin{proof}
	Let $Y=y_1,...,y_k$ be a randomised report generated by \rustdoc{measurements/fn}{make\_rappor}. Then the probability of observing any given report $Y$ is $P[Y=y | X=x]$. $x=x_1,...,x_k$ is a single Boolean vector with at most $m$ ones. 
	Without loss of generality assume that $x^*=\{x_1=1,...,x_m=1,x_{m+1}=0,...,x_k=0\}$, then we have
	\begin{align}
		P[Y=y~|~X=x^*] &=%
			\prod\limits_{i=1}^m \left(\frac{1}{2}f\right)^{1-y_i}\left(1-\frac{1}{2}f\right)^{y_i}%
			\times \prod\limits_{i=m+1}^k\left(\frac{1}{2}f\right)^{y_i} \left(1-\frac{1}{2}f\right)^{1-y_i}\\
	&= \left(\frac{1}{2}f\right)^{\sum_{i=1}^m 1-y_i}%
		\times \left(1-\frac{1}{2}f\right)^{\sum_{i=1}^m y_i}%
		\times \left(\frac{1}{2}f\right)^{\sum_{i=m+1}^k y_i}%
		\times \left(\frac{1}{2}f\right)^{\sum_{i=m+1}^k 1-y_i}
	\end{align}
	Then let $D$ be the ratio of two such conditional probabilities with distinct values $x_1$ and $x_2$, and let $S$ be the range of \rustdoc{measurements/fn}{make\_rappor}.
	\begin{align}
		D &= \frac{P[Y\in S~|~X=x_1]}{P[Y\in S~|~X=x_2]}\\
			&= \frac{\sum_{y\in S}P[Y=y~|~X=x_1]}{\sum_{y\in S}P[Y=y~|~X=x_2]}\\
			&\leq \max_{y\in S}\frac{P[Y=y~|~X=x_1]}{P[Y=y~|~X=x_2]}\\
			&=\max_{y\in S}\frac{%
				\prod\limits_{i=1}^m \left(\frac{1}{2}f\right)^{1-y_i}\left(1-\frac{1}{2}f\right)^{y_i}%
				\times \prod\limits_{i=m+1}^k\left(\frac{1}{2}f\right)^{y_i} \left(1-\frac{1}{2}f\right)^{1-y_i}
			}{%
				\prod\limits_{i=1}^m \left(\frac{1}{2}f\right)^{y_i}\left(1-\frac{1}{2}f\right)^{1-y_i}%
				\times \prod\limits_{i=m+1}^{2m}\left(\frac{1}{2}f\right)^{1-y_i} \left(1-\frac{1}{2}f\right)^{y_i}\times%
				\prod\limits_{i=2m+1}^{k}\left(\frac{1}{2}f\right)^{y_i}\left(1-\frac{1}{2}f\right)^{1-y_i}
			}\\
			&=\max_{y\in S}\frac{%
				\prod\limits_{i=1}^m \left(\frac{1}{2}f\right)^{1-y_i}\left(1-\frac{1}{2}f\right)^{y_i}%
				\times \prod\limits_{i=m+1}^{2m}\left(\frac{1}{2}f\right)^{y_i} \left(1-\frac{1}{2}f\right)^{1-y_i}%
				\times \prod\limits_{i=2m+1}^{k}\left(\frac{1}{2}f\right)^{y_i} \left(1-\frac{1}{2}f\right)^{1-y_i}
			}{%
				\prod\limits_{i=1}^m \left(\frac{1}{2}f\right)^{y_i}\left(1-\frac{1}{2}f\right)^{1-y_i}%
				\times \prod\limits_{i=m+1}^{2m}\left(\frac{1}{2}f\right)^{1-y_i} \left(1-\frac{1}{2}f\right)^{y_i}%
				\times\prod\limits_{i=2m+1}^{k}\left(\frac{1}{2}f\right)^{y_i}\left(1-\frac{1}{2}f\right)^{1-y_i}
			}\\
			&=\max_{y\in S}\frac{%
				\prod\limits_{i=1}^m \left(\frac{1}{2}f\right)^{1-y_i}\left(1-\frac{1}{2}f\right)^{y_i}%
				\times \prod\limits_{i=m+1}^{2m}\left(\frac{1}{2}f\right)^{y_i} \left(1-\frac{1}{2}f\right)^{1-y_i}%
			}{%
				\prod\limits_{i=1}^m \left(\frac{1}{2}f\right)^{y_i}\left(1-\frac{1}{2}f\right)^{1-y_i}%
				\times \prod\limits_{i=m+1}^{2m}\left(\frac{1}{2}f\right)^{1-y_i} \left(1-\frac{1}{2}f\right)^{y_i}%
			}\\ \label{eq:maximise-product}
			&=\max_{y\in S}\left[%
				\prod\limits_{i=1}^m \left(\frac{1}{2}f\right)^{2(1-y_i)}\left(1-\frac{1}{2}f\right)^{2y_i}%
				\times \prod\limits_{i=m+1}^{2m}\left(\frac{1}{2}f\right)^{2y_i} \left(1-\frac{1}{2}f\right)^{2(1-y_i)}\right]%
	\end{align}
	\ref{eq:maximise-product} is maximised when $y_1=1,...,y_m=1$, and $y_{m+1},...,y_{2m}=0$, giving
	\begin{align}
		D &= \left(1-\frac{1}{2}f\right)^{2m}\times\left(\frac{1}{2}f\right)^{-2m}\\
			&= \left(\frac{2-f}{f}\right)^{2m}
	\end{align}
	Therefore,
	\begin{equation}
		\varepsilon = 2m\log\left(\frac{2-f}{f}\right)
	\end{equation}
\end{proof}

\bibliographystyle{plain}
\bibliography{references.bib}
\end{document}